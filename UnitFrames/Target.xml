<Ui xmlns="http://www.blizzard.com/wow/ui/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.blizzard.com/wow/ui/ ..\FrameXML\UI.xsd">
  <Script file="Target.lua" />

  <Frame name="FigTargetAuraTemplate" virtual="true" enableMouse="true">
    <Size x="24" y="24"/>
    <Layers>
      <Layer level="BACKGROUND">
        <Texture parentKey="texture">
          <Size x="24" y="24"/>
          <Anchors>
            <Anchor point="CENTER" relativeTo="$parent" relativePoint="CENTER"/>
          </Anchors>
        </Texture>
      </Layer>
      <Layer level="ARTWORK">
        <Texture parentKey="textureTint">
          <Size x="24" y="24"/>
          <Anchors>
            <Anchor point="CENTER" relativeTo="$parent" relativePoint="CENTER" />
          </Anchors>            
        </Texture>
      </Layer>
      <Layer level="OVERLAY">
        <FontString parentKey="text" inherits="SystemFont_Shadow_Small">
          <Size y="10"/>
          <Anchors>
            <Anchor point="TOP" relativeTo="$parent" relativePoint="BOTTOM" />
          </Anchors>
        </FontString>
        <FontString parentKey="stackCount" inherits="SystemFont_Shadow_Small">
          <Size y="10"/>
          <Anchors>
            <Anchor point="BOTTOMRIGHT" relativeTo="$parent" relativePoint="BOTTOMRIGHT" />
          </Anchors>
        </FontString>
      </Layer>
    </Layers>
    
    <Scripts>
      <OnLoad>
        -- update status every quarter second
        self.statusTick = 0.25
        self.elapsedSinceLastStatusTick = 0
        self:SetScript('OnUpdate', FigTarget.updateAuraStatus)
      </OnLoad>
    </Scripts>
  </Frame>
  
  <Frame name="FigTargetBuffTemplate" virtual="true" inherits="FigTargetAuraTemplate">
    <Scripts>
      <OnLoad inherit="append">
        self.auraType = 'HELPFUL'
      </OnLoad>
      <OnEnter>
        GameTooltip:SetOwner(self, 'ANCHOR_TOPLEFT')
        GameTooltip:SetUnitBuff('target', self.auraIndex)
        GameTooltip:Show()
      </OnEnter>
      <OnLeave>
        GameTooltip:Hide()
      </OnLeave>
    </Scripts>
  </Frame>
  
  <Frame name="FigTargetDebuffTemplate" virtual="true" inherits="FigTargetAuraTemplate">
    <Scripts>
      <OnLoad inherit="append">
        self.auraType = 'HARMFUL'
      </OnLoad>
      <OnEnter>
        GameTooltip:SetOwner(self, 'ANCHOR_TOPLEFT')
        GameTooltip:SetUnitDebuff('target', self.auraIndex, 'HARMFUL')
        GameTooltip:Show()
      </OnEnter>
      <OnLeave>
        GameTooltip:Hide()
      </OnLeave>
    </Scripts>
  </Frame>

  <Button name="FigTargetFrame" inherits="SecureUnitButtonTemplate,FigBorderedTemplate" parent="UIParent">
    <Size x="200" y="50"/>
    <Anchors>
      <Anchor point="TOPRIGHT" relativeTo="UIParent" relativePoint="CENTER" x="310" y="-100" />
    </Anchors>

    <Frames>
      <!-- HP -->
      <StatusBar parentKey="hp" minValue="0" maxValue="100" defaultValue="100">
        <Size x="200" y="40"/>
        <Anchors>
          <Anchor point="TOP" relativeTo="$parent" relativePoint="TOP" />
        </Anchors>

        <BarTexture file="Interface\AddOns\FigUI\Textures\GenericBarFill"/>
        <BarColor r="0" g="0" b="0" a="1"/>

        <Layers>
          <Layer level="BACKGROUND">
            <Texture>
              <Color r="0" g="0" b="0" a="0.5"/>
            </Texture>
          </Layer>
          <Layer level="ARTWORK">
            <FontString parentKey="text" inherits="SystemFont_Shadow_Med3">
              <Anchors>
                <Anchor point="RIGHT" y="-10"/>
              </Anchors>
            </FontString>
            <FontString parentKey="playerInfo" inherits="SystemFont_Shadow_Small">
              <Anchors>
                <Anchor point="TOPLEFT" x="4" y="-2" />
              </Anchors>
            </FontString>
          </Layer>
        </Layers>
      </StatusBar>

      <!-- Power -->
      <StatusBar parentKey="power" minValue="0" maxValue="100" defaultValue="100">
        <Size x="200" y="10"/>
        <Anchors>
          <Anchor point="BOTTOM" relativeTo="$parent" relativePoint="BOTTOM" />
        </Anchors>

        <BarTexture file="Interface\AddOns\FigUI\Textures\GenericBarFill"/>
        <BarColor r="0" g="0" b="0" a="1"/>

        <Layers>
          <Layer level="BACKGROUND">
            <Texture>
              <Color r="0" g="0" b="0" a="0.5"/>
            </Texture>
          </Layer>
          <Layer level="ARTWORK">
            <FontString parentKey="text" inherits="SystemFont_Shadow_Small">
              <Anchors>
                <Anchor point="RIGHT"/>
              </Anchors>
            </FontString>
          </Layer>
        </Layers>
      </StatusBar>
    </Frames>

    <Scripts>
      <OnLoad inherit="prepend">
        -- configure to behave like default target frame
	      self:RegisterForClicks("LeftButtonUp", "RightButtonUp");
        local showMenu = function()
          ToggleDropDownMenu(1, nil, TargetFrameDropDown, self, 0, 0);
        end
        SecureUnitButton_OnLoad(self, 'target', showMenu)
        self:SetAttribute('unit', 'target')
        RegisterUnitWatch(self, false)

        FigTarget.initialize(self)
      </OnLoad>
      <OnEnter>
        GameTooltip_SetDefaultAnchor(GameTooltip, UIParent)
        GameTooltip:SetUnit('target')
        GameTooltip:Show()
      </OnEnter>
      <OnShow>
        FigTarget.onShow(self)
      </OnShow>
    </Scripts>
  </Button>
</Ui>